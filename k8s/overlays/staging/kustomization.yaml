apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: orchestrator-staging

bases:
  - ../../base

namePrefix: staging-

commonLabels:
  environment: staging
  app.kubernetes.io/environment: staging

images:
  - name: orchestrator
    newName: your-registry/orchestrator
    newTag: staging
  - name: probe-agent
    newName: your-registry/probe-agent
    newTag: staging

replicas:
  - name: orchestrator
    count: 2

configMapGenerator:
  - name: orchestrator-config
    behavior: merge
    literals:
      - LOG_LEVEL=info
      - METRICS_ENABLED=true

patchesStrategicMerge:
  - |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: orchestrator
    spec:
      template:
        spec:
          containers:
          - name: orchestrator
            resources:
              requests:
                cpu: 500m
                memory: 512Mi
              limits:
                cpu: 1500m
                memory: 1536Mi
